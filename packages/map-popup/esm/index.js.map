{"version":3,"sources":["../src/index.tsx"],"names":["React","useCallback","Styled","BaseMapStyled","FromToLocationPicker","FormattedMessage","useIntl","flatten","S","defaultEnglishMessages","makeDefaultGetEntityName","defaultMessages","generateLocation","entity","name","entityLon","lon","entityLat","lat","x","y","StationHubDetails","station","value","bikesAvailable","spacesAvailable","StopDetails","id","setViewedStop","stopId","entityIsStation","MapPopup","configCompanies","getEntityName","setLocation","intl","getNameFunc","bikesAvailablePresent","entityIsStationHub","undefined","isFloatingBike","code","split"],"mappings":"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","sourcesContent":["import React, { useCallback } from \"react\";\n\nimport { Styled as BaseMapStyled } from \"@opentripplanner/base-map\";\nimport FromToLocationPicker from \"@opentripplanner/from-to-location-picker\";\n// eslint-disable-next-line prettier/prettier\nimport type { Company, ConfiguredCompany, Location, Station, Stop, StopEventHandler } from \"@opentripplanner/types\";\n\nimport { FormattedMessage, useIntl } from \"react-intl\";\nimport { flatten } from \"flat\";\nimport * as S from \"./styled\";\n\n// Load the default messages.\nimport defaultEnglishMessages from \"../i18n/en-US.yml\";\nimport { makeDefaultGetEntityName } from \"./util\";\n\n// HACK: We should flatten the messages loaded above because\n// the YAML loaders behave differently between webpack and our version of jest:\n// - the yaml loader for webpack returns a nested object,\n// - the yaml loader for jest returns messages with flattened ids.\nexport const defaultMessages: { [key: string]: string } = flatten(defaultEnglishMessages);\n\nconst generateLocation = (entity: Entity, name: string) => {\n  // @ts-expect-error some of these values may be null, but that's ok\n  const { lon: entityLon, lat: entityLat, x, y } = entity\n\n  const lat = entityLat || y\n  const lon = entityLon || x\n  if (!lat || !lon) return null\n\n  return { lat, lon, name };\n}\n\nconst StationHubDetails = ({ station }: { station: Station }) => {\n  return (\n    <BaseMapStyled.PopupRow>\n      <div>\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.MapPopup.availableBikes\"]\n          }\n          description=\"Label text for the number of bikes available\"\n          id=\"otpUi.MapPopup.availableBikes\"\n          values={{ value: station.bikesAvailable }}\n        />\n      </div>\n      <div>\n        <FormattedMessage\n          defaultMessage={\n            defaultMessages[\"otpUi.MapPopup.availableDocks\"]\n          }\n          description=\"Label text for the number of docks available\"\n          id=\"otpUi.MapPopup.availableDocks\"\n          values={{ value: station.spacesAvailable }}\n        />\n      </div>\n    </BaseMapStyled.PopupRow>\n  )\n}\n\nconst StopDetails = ({ id, setViewedStop }: { id: string, setViewedStop: () => void; }) => {\n  return (\n    <BaseMapStyled.PopupRow>\n      <strong>\n        <FormattedMessage\n          defaultMessage={defaultMessages[\"otpUi.MapPopup.stopId\"]}\n          description=\"Displays the stop id\"\n          id=\"otpUi.MapPopup.stopId\"\n          values={{\n            stopId: id\n          }}\n        />\n      </strong>\n      <S.ViewStopButton onClick={setViewedStop}>\n        <FormattedMessage\n          defaultMessage={defaultMessages[\"otpUi.MapPopup.stopViewer\"]}\n          description=\"Text for link that opens the stop viewer\"\n          id=\"otpUi.MapPopup.stopViewer\"\n        />\n      </S.ViewStopButton>\n    </BaseMapStyled.PopupRow>\n  )\n}\n\ntype Entity = Stop | Station\ntype Props = {\n  configCompanies?: ConfiguredCompany[];\n  entity: Entity\n  getEntityName?: (entity: Entity, configCompanies: Company[],) => string;\n  setLocation?: ({ location, locationType }: { location: Location, locationType: string }) => void;\n  setViewedStop?: StopEventHandler;\n};\n\nfunction entityIsStation(entity: Entity): entity is Station {\n  return \"bikesAvailable\" in entity\n}\n\n/**\n * Renders a map popup for a stop, scooter, or shared bike\n */\nexport function MapPopup({ configCompanies, entity, getEntityName, setLocation, setViewedStop }: Props): JSX.Element {\n  const intl = useIntl()\n  if (!entity) return <></>\n\n  const getNameFunc = getEntityName || makeDefaultGetEntityName(intl, defaultMessages);\n  const name = getNameFunc(entity, configCompanies);\n\n\n  const bikesAvailablePresent = entityIsStation(entity)\n  const entityIsStationHub = bikesAvailablePresent && entity?.bikesAvailable !== undefined && !entity?.isFloatingBike;\n  const stopId = !bikesAvailablePresent && entity?.code || entity.id.split(\":\")[1] || entity.id\n\n  return (\n    <BaseMapStyled.MapOverlayPopup>\n      <BaseMapStyled.PopupTitle>{name}</BaseMapStyled.PopupTitle>\n      {/* render dock info if it is available */}\n      {entityIsStationHub && <StationHubDetails station={entity} />}\n\n      {/* render stop viewer link if available */}\n      {setViewedStop && !bikesAvailablePresent && (\n        <StopDetails\n          id={stopId}\n          setViewedStop={useCallback(() => setViewedStop(entity), [entity])}\n        />\n      )}\n\n      {/* The \"Set as [from/to]\" ButtonGroup */}\n      {setLocation && (\n        <BaseMapStyled.PopupRow>\n          <FromToLocationPicker\n            label\n            location={generateLocation(entity, name)}\n            setLocation={setLocation}\n          />\n        </BaseMapStyled.PopupRow>\n      )}\n    </BaseMapStyled.MapOverlayPopup>\n  );\n}\n\nexport default MapPopup;\n\n// Rename styled components for export.\nexport { S as Styled };\n"],"file":"index.js"}