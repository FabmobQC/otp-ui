{"version":3,"sources":["../src/endpoint.tsx"],"names":["defaultMessages","defaultEnglishMessages","UserLocationInnerIcon","type","UserLocationIcon","Endpoint","props","intl","rememberAsHome","location","propsLocation","rememberPlace","icon","id","rememberAsWork","forgetHome","forgetPlace","forgetWork","clearLocation","propsClearLocation","locationType","swapLocation","setLocation","otherType","onDragEnd","e","rawLocation","lngLat","coordinates","lat","lon","lng","name","formatMessage","defaultMessage","description","reverseGeocode","showPopup","setShowPopup","locations","MapMarkerIcon","showUserSettings","match","find","l","coreUtils","map","matchLatLon","isWork","isHome","iconHtml"],"mappings":"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","sourcesContent":["import { Briefcase } from \"@styled-icons/fa-solid/Briefcase\";\nimport { Popup } from \"@opentripplanner/base-map\";\nimport {\n  ClearLocationArg,\n  Location,\n  MapLocationActionArg,\n  UserLocationAndType\n} from \"@opentripplanner/types\";\nimport { FormattedMessage, useIntl } from \"react-intl\";\nimport { Home } from \"@styled-icons/fa-solid/Home\";\nimport { MapMarkerAlt } from \"@styled-icons/fa-solid/MapMarkerAlt\";\nimport { Marker, MarkerDragEvent } from \"react-map-gl\";\nimport { Sync } from \"@styled-icons/fa-solid/Sync\";\nimport { Times } from \"@styled-icons/fa-solid/Times\";\nimport coreUtils from \"@opentripplanner/core-utils\";\nimport flatten from \"flat\";\nimport React, { ComponentType, useState } from \"react\";\n\nimport * as S from \"./styled\";\n\n// Load the default messages.\nimport defaultEnglishMessages from \"../i18n/en-US.yml\";\n\ninterface Props {\n  clearLocation: (arg: ClearLocationArg) => void;\n  forgetPlace: (type: string) => void;\n  location?: Location;\n  locations: Location[];\n  MapMarkerIcon: ComponentType<UserLocationAndType>;\n  rememberPlace: (arg: UserLocationAndType) => void;\n  setLocation: (arg: MapLocationActionArg) => void;\n  showUserSettings: boolean;\n  type: string;\n}\n\ninterface IconProps {\n  type: string;\n}\n\n// HACK: We should flatten the messages loaded above because\n// the YAML loaders behave differently between webpack and our version of jest:\n// - the yaml loader for webpack returns a nested object,\n// - the yaml loader for jest returns messages with flattened ids.\nconst defaultMessages: Record<string, string> = flatten(defaultEnglishMessages);\n\n/**\n * These icons are used to render common icons for user locations. These will\n * only show up in applications that allow saving user locations.\n */\nfunction UserLocationInnerIcon({ type }: IconProps) {\n  switch (type) {\n    case \"briefcase\":\n      return <Briefcase size={12} />;\n    case \"home\":\n      return <Home size={12} />;\n    case \"map-marker\":\n      return <MapMarkerAlt size={12} />;\n    case \"refresh\":\n      return <Sync size={12} />;\n    case \"times\":\n      return <Times size={12} />;\n    default:\n      return null;\n  }\n}\n\n/**\n * Wrapper for icon that includes spacing.\n */\nfunction UserLocationIcon({ type }: IconProps) {\n  return (\n    <S.IconWrapper>\n      <UserLocationInnerIcon type={type} />\n    </S.IconWrapper>\n  );\n}\n\nconst Endpoint = (props: Props): JSX.Element => {\n  const intl = useIntl();\n\n  const rememberAsHome = (): void => {\n    const { location: propsLocation, rememberPlace } = props;\n    const location = {\n      ...propsLocation,\n      icon: \"home\",\n      id: \"home\",\n      type: \"home\"\n    };\n    rememberPlace({ type: \"home\", location });\n  };\n\n  const rememberAsWork = (): void => {\n    const { location: propsLocation, rememberPlace } = props;\n    const location = {\n      ...propsLocation,\n      icon: \"briefcase\",\n      id: \"work\",\n      type: \"work\"\n    };\n    rememberPlace({ type: \"work\", location });\n  };\n\n  const forgetHome = (): void => {\n    const { forgetPlace } = props;\n    forgetPlace(\"home\");\n  };\n\n  const forgetWork = (): void => {\n    const { forgetPlace } = props;\n    forgetPlace(\"work\");\n  };\n\n  const clearLocation = (): void => {\n    const { clearLocation: propsClearLocation, type } = props;\n    propsClearLocation({ locationType: type });\n  };\n\n  const swapLocation = (): void => {\n    const { location, setLocation, type } = props;\n    clearLocation();\n    const otherType = type === \"from\" ? \"to\" : \"from\";\n    setLocation({ locationType: otherType, location });\n  };\n\n  const onDragEnd = (e: MarkerDragEvent) => {\n    const { setLocation, type } = props;\n    const rawLocation = e.lngLat;\n    const coordinates = {\n      lat: rawLocation.lat,\n      lon: rawLocation.lng\n    };\n\n    const location = {\n      ...coordinates,\n      name: intl.formatMessage(\n        {\n          defaultMessage: defaultMessages[\"otpUi.EndpointsOverlay.coordinates\"],\n          description:\n            \"Formats rendering coordinates for a locale using the correct number separator\",\n          // FIXME: Combine with the same method at\n          // https://github.com/opentripplanner/otp-react-redux/blob/6d5bc90e57843822809b0dff397bad19d66aeb43/lib/components/form/user-settings.js#L34\n          // and move this potentially shared message to an appropriate package.\n          id: \"otpUi.EndpointsOverlay.coordinates\"\n        },\n        coordinates\n      )\n    };\n    setLocation({ locationType: type, location, reverseGeocode: true });\n  };\n\n  const [showPopup, setShowPopup] = useState(false);\n  const { location, locations, MapMarkerIcon, showUserSettings, type } = props;\n  if (!(location && location.lat && location.lon)) return null;\n  const match = locations.find(l => coreUtils.map.matchLatLon(l, location));\n  const isWork = match && match.type === \"work\";\n  const isHome = match && match.type === \"home\";\n  const iconHtml = <MapMarkerIcon location={location} type={type} />;\n  const otherType = type === \"from\" ? \"to\" : \"from\";\n  const icon = isWork ? \"briefcase\" : isHome ? \"home\" : \"map-marker\";\n  return (\n    // We have to use the standard marker here since we need to adjust state\n    // after and during drag\n    <Marker\n      anchor=\"center\"\n      draggable\n      latitude={location.lat}\n      longitude={location.lon}\n      onDragEnd={onDragEnd}\n      onDragStart={() => setShowPopup(false)}\n      onClick={() => setShowPopup(true)}\n    >\n      {iconHtml}\n      {showPopup && showUserSettings && (\n        <Popup\n          onClose={() => setShowPopup(false)}\n          latitude={location.lat}\n          longitude={location.lon}\n        >\n          <div>\n            <strong>\n              <UserLocationIcon type={icon} />\n              {location.name}\n            </strong>\n            <div>\n              <S.Button\n                disabled={isWork}\n                onClick={isHome ? forgetHome : rememberAsHome}\n              >\n                {isHome ? (\n                  <>\n                    <UserLocationIcon type=\"times\" />\n                    <FormattedMessage\n                      defaultMessage={\n                        defaultMessages[\"otpUi.EndpointsOverlay.forgetHome\"]\n                      }\n                      description=\"Button text to forget the home location\"\n                      id=\"otpUi.EndpointsOverlay.forgetHome\"\n                    />\n                  </>\n                ) : (\n                  <>\n                    <UserLocationIcon type=\"home\" />\n                    <FormattedMessage\n                      defaultMessage={\n                        defaultMessages[\"otpUi.EndpointsOverlay.saveAsHome\"]\n                      }\n                      description=\"Button text to save the location as home location\"\n                      id=\"otpUi.EndpointsOverlay.saveAsHome\"\n                    />\n                  </>\n                )}\n              </S.Button>\n            </div>\n            <div>\n              <S.Button\n                disabled={isHome}\n                onClick={isWork ? forgetWork : rememberAsWork}\n              >\n                {isWork ? (\n                  <>\n                    <UserLocationIcon type=\"times\" />\n                    <FormattedMessage\n                      defaultMessage={\n                        defaultMessages[\"otpUi.EndpointsOverlay.forgetWork\"]\n                      }\n                      description=\"Button text to forget the work location\"\n                      id=\"otpUi.EndpointsOverlay.forgetWork\"\n                    />\n                  </>\n                ) : (\n                  <>\n                    <UserLocationIcon type=\"briefcase\" />\n                    <FormattedMessage\n                      defaultMessage={\n                        defaultMessages[\"otpUi.EndpointsOverlay.saveAsWork\"]\n                      }\n                      description=\"Button text to save the location as work location\"\n                      id=\"otpUi.EndpointsOverlay.saveAsWork\"\n                    />\n                  </>\n                )}\n              </S.Button>\n            </div>\n            <div>\n              <S.Button onClick={clearLocation}>\n                <UserLocationIcon type=\"times\" />\n                <FormattedMessage\n                  defaultMessage={\n                    defaultMessages[\"otpUi.EndpointsOverlay.clearLocation\"]\n                  }\n                  description=\"Button text to clear the from/to location\"\n                  id=\"otpUi.EndpointsOverlay.clearLocation\"\n                  values={{ locationType: type }}\n                />\n              </S.Button>\n            </div>\n            <div>\n              <S.Button onClick={swapLocation}>\n                <UserLocationIcon type=\"refresh\" />\n                <FormattedMessage\n                  defaultMessage={\n                    defaultMessages[\"otpUi.EndpointsOverlay.swapLocation\"]\n                  }\n                  description=\"Button text to swap the from/to location\"\n                  id=\"otpUi.EndpointsOverlay.swapLocation\"\n                  values={{ locationType: otherType }}\n                />\n              </S.Button>\n            </div>\n          </div>\n        </Popup>\n      )}\n    </Marker>\n  );\n};\n\nexport default Endpoint;\n"],"file":"endpoint.js"}